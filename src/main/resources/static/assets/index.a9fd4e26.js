var e=Object.defineProperty,a=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,t=Object.prototype.propertyIsEnumerable,r=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t;import{T as o}from"./index.d30c5476.js";import{d as n,L as s,r as i,A as d,B as u,_ as m,a as p,o as c,c as b,w as g,b as h,g as f,t as y,e as w,F as D,f as v,h as _,i as C,j as T,k as x,l as V,C as j,D as F,m as O}from"./index.c4c68ae8.js";const S=[{value:!0,label:"啟用"},{value:!1,label:"停止"}],k=n({components:{Layer:s},props:{layer:{type:Object,default:()=>({show:!1,title:"",showButton:!0})}},setup(e,a){const l=i(null),t=i(null);let r=i({username:"",enabled:!0});return e.layer.row&&(r.value=JSON.parse(JSON.stringify(e.layer.row))),{form:r,rules:{username:[{required:!0,message:"請輸入用戶名",trigger:"blur"}],password:[{required:!0,message:"請輸入密碼",trigger:"blur"}],enabled:[{required:!0,message:"請選擇",trigger:"blur"}]},layerDom:t,ruleForm:l,radioData:S}},methods:{submit(){this.ruleForm&&this.ruleForm.validate((e=>{if(!e)return!1;{let e=this.form;this.layer.row?this.updateForm(e):this.addForm(e)}}))},addForm(e){d(e).then((e=>{this.$message({type:200==e.code?"success":"error",message:e.msg}),this.$emit("getTableData",!0),this.layerDom&&this.layerDom.close()}))},updateForm(e){u(e).then((e=>{this.$message({type:"success",message:e.msg}),this.$emit("getTableData",!1),this.layerDom&&this.layerDom.close()}))}}});const q=n({name:"crudTable",components:{Table:o,Layer:m(k,[["render",function(e,a,l,t,r,o){const n=p("el-input"),s=p("el-form-item"),i=p("el-radio"),d=p("el-radio-group"),u=p("el-form"),m=p("Layer",!0);return c(),b(m,{layer:e.layer,onConfirm:e.submit,ref:"layerDom"},{default:g((()=>[h(u,{model:e.form,rules:e.rules,ref:"ruleForm","label-width":"120px",style:{"margin-right":"30px"}},{default:g((()=>[h(s,{label:"用户名",prop:"username"},{default:g((()=>[h(n,{modelValue:e.form.username,"onUpdate:modelValue":a[0]||(a[0]=a=>e.form.username=a),placeholder:"請輸入用戶名"},null,8,["modelValue"])])),_:1}),h(s,{label:"密碼：",prop:"password"},{default:g((()=>[h(n,{type:"password",modelValue:e.form.password,"onUpdate:modelValue":a[1]||(a[1]=a=>e.form.password=a),placeholder:"請輸入密碼"},null,8,["modelValue"])])),_:1}),f(" "+y(e.form.radio)+" ",1),h(s,{label:"狀態：",prop:"enabled"},{default:g((()=>[h(d,{modelValue:e.form.enabled,"onUpdate:modelValue":a[2]||(a[2]=a=>e.form.enabled=a)},{default:g((()=>[(c(!0),w(D,null,v(e.radioData,(e=>(c(),b(i,{key:e.value,label:e.value},{default:g((()=>[f(y(e.label),1)])),_:2},1032,["label"])))),128))])),_:1},8,["modelValue"])])),_:1})])),_:1},8,["model","rules"])])),_:1},8,["layer","onConfirm"])}]])},setup(){const e=_({input:""}),o=_({show:!1,title:"新增",showButton:!0}),n=_({index:1,size:20,total:0}),s=i(!0),d=i([]),u=i([]),m=o=>{s.value=!0,o&&(n.index=1);let i=((e,o)=>{for(var n in o||(o={}))l.call(o,n)&&r(e,n,o[n]);if(a)for(var n of a(o))t.call(o,n)&&r(e,n,o[n]);return e})({page:n.index-1,pageSize:n.size},e);j(i).then((e=>{d.value=e.data.list,n.total=Number(e.data.pager.total)})).catch((e=>{d.value=[],n.index=1,n.total=0})).finally((()=>{s.value=!1}))};return m(!0),{query:e,tableData:d,chooseData:u,loading:s,page:n,layer:o,handleSelectionChange:e=>{u.value=e},handleAdd:()=>{o.title="新增數據",o.show=!0,delete o.row},handleEdit:e=>{o.title="編輯數據",o.row=e,o.show=!0},handleDel:e=>{let a={ids:e.map((e=>e.id)).join(",")};F(a).then((e=>{O({type:"success",message:e.msg}),m(1===d.value.length)}))},getTableData:m}}}),I={class:"layout-container"},L={class:"layout-container-form flex space-between"},P={class:"layout-container-form-handle"},U={class:"layout-container-form-search"},G={class:"layout-container-table"};var $=m(q,[["render",function(e,a,l,t,r,o){const n=p("el-button"),s=p("el-popconfirm"),i=p("el-input"),d=p("el-table-column"),u=p("Table"),m=p("Layer"),y=C("loading");return c(),w("div",I,[T("div",L,[T("div",P,[h(n,{type:"primary",icon:"el-icon-circle-plus-outline",onClick:e.handleAdd},{default:g((()=>[f("新增")])),_:1},8,["onClick"]),h(s,{title:"批量删除",onConfirm:a[0]||(a[0]=a=>e.handleDel(e.chooseData))},{reference:g((()=>[h(n,{type:"danger",icon:"el-icon-delete",disabled:0===e.chooseData.length},{default:g((()=>[f("批量删除")])),_:1},8,["disabled"])])),_:1})]),T("div",U,[h(i,{modelValue:e.query.input,"onUpdate:modelValue":a[1]||(a[1]=a=>e.query.input=a),placeholder:"请输入关键词进行检索",onChange:a[2]||(a[2]=a=>e.getTableData(!0))},null,8,["modelValue"]),h(n,{type:"primary",icon:"el-icon-search",class:"search-btn",onClick:a[3]||(a[3]=a=>e.getTableData(!0))},{default:g((()=>[f("搜索")])),_:1})])]),T("div",G,[x((c(),b(u,{ref:"table",page:e.page,"onUpdate:page":a[4]||(a[4]=a=>e.page=a),showIndex:!0,showSelection:!0,data:e.tableData,onGetTableData:e.getTableData,onSelectionChange:e.handleSelectionChange},{default:g((()=>[h(d,{prop:"username",label:"用戶名",align:"center"}),h(d,{prop:"roles",label:"角色",align:"center"}),h(d,{prop:"enabled",label:"狀態",align:"center"}),h(d,{prop:"createTime",label:"創建時間",align:"center"}),h(d,{prop:"regIp",label:"註冊IP",align:"center"}),h(d,{prop:"lastLoginIP",label:"最後登入IP",align:"center"}),h(d,{label:"操作",align:"center",fixed:"right",width:"200"},{default:g((a=>[h(n,{onClick:l=>e.handleEdit(a.row)},{default:g((()=>[f("编辑")])),_:2},1032,["onClick"]),h(s,{title:"删除",onConfirm:l=>e.handleDel([a.row])},{reference:g((()=>[h(n,{type:"danger"},{default:g((()=>[f("删除")])),_:1})])),_:2},1032,["onConfirm"])])),_:1})])),_:1},8,["page","data","onGetTableData","onSelectionChange"])),[[y,e.loading]]),e.layer.show?(c(),b(m,{key:0,layer:e.layer,onGetTableData:e.getTableData},null,8,["layer","onGetTableData"])):V("",!0)])])}]]);export{$ as default};
